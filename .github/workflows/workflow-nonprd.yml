# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on PR

'on':
  push:
    branches:
      - develop

jobs:
   build-and-deploy-nonprd:
    permissions:
      checks: write
      contents: read
      pull-requests: write
    runs-on: ubuntu-latest
    if: ${{ !startsWith(github.ref_name, 'develop') }}
    steps:
      - uses: actions/checkout@v3
      
      - uses: actions/setup-node@v3
        with:
          node-version: 18.13.0

      - name: Build website
        run: |
          yarn install
          yarn generate
      
      - uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_OCEANFT_NONPROD_8C4C2 }}'
          channelId: live
          projectId: oceanft-nonprod-8c4c2

  # build-and-preview-nonprd:
  #   permissions:
  #     checks: write
  #     contents: read
  #     pull-requests: write
  #   runs-on: ubuntu-latest  
  #   # if: '${{ github.event.pull_request.head.repo.full_name == github.repository }}'
  #   if: ${{ !startsWith(github.ref_name, 'main') }}
  #   steps:
  #     - uses: actions/checkout@v3
      
  #     - uses: actions/setup-node@v3
  #       with:
  #         node-version: 18.13.0

  #     - name: Build website
  #       run: |
  #         yarn install
  #         yarn generate

  #     - uses: FirebaseExtended/action-hosting-deploy@v0
  #       with:
  #         repoToken: ${{ secrets.GITHUB_TOKEN }}
  #         firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_OCEANFT_NONPROD_8C4C2 }}'
  #         projectId: oceanft-nonprod-8c4c2
  #         expires: 7d

  # build-and-preview-prd:
  #   permissions:
  #     checks: write
  #     contents: read
  #     pull-requests: write
  #   runs-on: 
  #     - self-hosted
  #     - develop
  #   if: ${{ startsWith(github.ref_name, 'main') }}
  #   steps:
  #     - uses: actions/checkout@v3
      
  #     - uses: actions/setup-node@v3
  #       with:
  #         node-version: 18.13.0

  #     - name: Build website
  #       run: |
  #         yarn install
  #         yarn generate

  #     - uses: FirebaseExtended/action-hosting-deploy@v0
  #       with:
  #         repoToken: ${{ secrets.GITHUB_TOKEN }}
  #         firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_OCEANFT_1864F }}'
  #         projectId: oceanft-1864f
  #         expires: 7d